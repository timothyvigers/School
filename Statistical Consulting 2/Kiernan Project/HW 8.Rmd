---
title: "Consulting Homework 8"
author: "Tim Vigers"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(tableone)
library(DiagrammeR)
library(knitr)
```

```{r echo=FALSE,include=FALSE}
# Import data
source("/Users/timvigers/Documents/GitHub/School/Statistical Consulting 2/Kiernan Project/Data/survey.r")
# Clean for analysis
analysis_set <- data %>%
  filter(agree.factor == "Yes",
         intro_backpack_in_3_yrs.factor == "Yes",
         intro_age_18.factor == "Yes",intro_age_89.factor == "Yes",
         !(is.na(back_pain_in_3_years)))
```

```{r echo=FALSE}
grViz("digraph flowchart {
      node [fontname = Helvetica, shape = rectangle]        
      tab1 [label = '@@1']
      tab2 [label = '@@2']
      tab3 [label = '@@3']
      tab4 [label = '@@4']
      tab5 [label = '@@5']
      tab6 [label = '@@6']

      # edge definitions with the node IDs
      tab1 -> tab2 -> tab3 -> tab4 -> tab5 -> tab6;
      }

      [1]: 'Participants responded to questionnaire n = 293'
      [2]: 'Participants agreed to terms and conditions n = 288'
      [3]: 'Participants had been hiking with a pack weighing 10 lbs or more in past 3 years n = 266'
      [4]: 'Participants older than 18 and younger than 89 n=265'
      [5]: 'Participants responded to the question about back pain in the past 3 years n = 240'
      [6]: 'Analysis sample n = 240' 
      ")
```

This analysis started out with 293 responses in total. Of these, 5 were excluded because the participant did not agree to the terms and conditions. Of the remaining 288 participants, 266 answered that they had been hiking with a pack weighing 10 lbs or more in past 3 years. An additional participant was excluded for indicating that they are over 89 years of age. Out of the remaining 265 participants, 240 responded to the question about back pain in the past 3 years, so this was group was used as the final analysis cohort.

Participants who did not answer "Yes" to agree.factor, intro_backpack_in_3_yrs.factor, intro_age_18.factor, or intro_age_89.factor were also excluded. 

### Table 2: Participants with pain while day hiking (pain_while_packing___1 == 1)

```{r echo=FALSE}
# Those with pain
with_pain_day_hike <- analysis_set %>%
  filter(pain_while_packing___1 == 1)
# Variables
freq_vars <- c("choose_from_picture.factor","back_pain_frequency.factor")
t2 <- CreateTableOne(freq_vars,data = with_pain_day_hike)
t2 <- print(t2,varLabels = T,printToggle=F)
kable(t2)
```

### Table 3: Fitting statistics, stratified by pain while day hiking

```{r echo=FALSE}
# Variables
vars <- c("prof_fit_for_day_pack.factor","physical_conditioning.factor",
          "day_pack_features___1.factor","day_pack_features___2.factor",
          "day_pack_features___3.factor","day_pack_features___4.factor",
          "day_pack_features___5.factor","day_pack_features___6.factor")
# Table
t3 <- CreateTableOne(vars,strata = "pain_while_packing___1",data = analysis_set)
t3 <- print(t3,varLabels = T,printToggle=F)
kable(t3[,1:2])
```

### Figure 1: Back pain severity by professional fit status

```{r echo=FALSE,warning=FALSE}
plot <- ggplot(subset(analysis_set,!is.na(prof_fit_for_day_pack.factor)),
               aes(x=prof_fit_for_day_pack.factor,y=as.numeric(back_pain)))+
  geom_boxplot(outlier.colour = "red")+
  xlab("Professional Fit")+
  ylab("Back Pain Severity (1-100)")+
  theme_classic()
plot
```

Only 47 out of the 240 participants in the analysis set experience pain while day hiking. Of these, the majority (42.6 %) experience pain in their lower back and experience back pain frequently (50 %). However, 2 participants then said they never experienced pain when choosing from the picture, and 3 said they never experienced pain in response to the frequency question. 

Interestingly, it appears from Figure 1 that the median and maximum back pain severity was slightly worse in those who had been professionally fit compared to those who were not (although significance testing was not performed). 