---
title: "Homework 6"
author: "Tim Vigers"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(lme4)
library(nlme)
```

```{r}
# Read in data
inv1 <- read.csv("/Users/timvigers/Documents/School/Biostatistical Methods 2/Homeworks/Homework 6/file2_FEV1.csv")
inv1$ID <- as.factor(inv1$ID)
inv1$trt <- as.factor(inv1$trt)
inv2 <- read.csv("/Users/timvigers/Documents/School/Biostatistical Methods 2/Homeworks/Homework 6/file1_FEV1.csv")
inv2$ID <- as.factor(inv2$ID)
inv3 <- inv1
```
 
## 1. Fit the models 
 
```{r}
# Models
inv1_mod <- lm(FEV1~pack_years+current_smoker+emphysema+race+height+bmi+trt,data=inv1)
inv2_mod <- lm(delta_FEV1~pre_FEV1+pack_years+current_smoker+emphysema+race+height+bmi,data=inv2)

# Random intercept
inv3_ri_nlme <- lme(FEV1~pack_years+current_smoker+emphysema+race+height+bmi+trt,random = ~1|ID,data=inv3)
inv3_ri_lmer <- lmer(FEV1~pack_years+current_smoker+emphysema+race+height+bmi+trt+(1|ID),data=inv3)

# Random intercept and random slope
inv3_ris_nlme <- lme(FEV1~pack_years+current_smoker+emphysema+race+height+bmi+trt,random = ~1+trt|ID,data=inv3)
# inv3_ris_lmer <- lmer(FEV1~trt+pack_years+current_smoker+emphysema+race+height+bmi+(1+trt|ID),data=inv3)
```

## Check that nlme and lme4 match for random intercept model:

```{r}
summary(inv3_ri_nlme)$tTable
summary(inv3_ri_lmer)$coefficients
```

### Compare to SAS:

![](/Users/timvigers/Documents/School/Biostatistical Methods 2/Homeworks/Homework 6/RI.png)

### Check that nlme matches SAS for random intercept and random slope model:

```{r}
summary(inv3_ris_nlme)$tTable
```

![](/Users/timvigers/Documents/School/Biostatistical Methods 2/Homeworks/Homework 6/RI and RS.png)

### 2. Investigator 2 vs. investigators 1 and 3